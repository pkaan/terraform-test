trigger:
- none


stages:
 - stage: Prepare_Deploy_Terraform_IaC
   displayName: "Prepare and Deploy Terraform IaC"
   jobs:
   - job: Prepare_Terraform
     pool:
       name: pkaan-selfhost-pool
       vmImage: ubuntu-latest
     steps:
     - task: TerraformInstaller@0
       displayName: "Install Terraform"
       inputs:
         terraformVersion: 'latest'
     - script: |
         terraform init
       displayName: 'Terraform init'
     - script: |
         terraform plan -out=appresources.tfplan
       displayName: 'Terraform Plan'
     - script: |
         terraform refresh      
       displayName: 'Terraform Refresh'
     - script: |
         terraform apply appresources.tfplan
       displayName: 'Terraform Apply'